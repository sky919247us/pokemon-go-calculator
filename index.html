<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POKEMON GO 50級試算器 V3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #FAFAFA;
            font-family: 'Inter', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif', '微軟正黑體';
        }
        .card {
            background-color: #FFFFFF;
            border: 1px solid #F0F0F0;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
        }
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #D1D5DB;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #4F46E5;
        }
        .btn-primary:hover {
            background-color: #4338CA;
        }
        .btn-secondary {
            background-color: #6B7280;
        }
        .btn-secondary:hover {
            background-color: #4B5563;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-3xl p-4 sm:p-6 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">POKEMON GO 50級試算器</h1>
            <p class="text-gray-500 mt-2">規劃你的升級之路，直到 2025/10/14</p>
        </header>

        <main>
            <!-- 控制區 -->
            <div class="card">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div>
                        <label for="level-select" class="block text-sm font-medium text-gray-700 mb-1">目前等級：</label>
                        <select id="level-select" class="form-input w-full sm:w-48 bg-gray-50">
                            <option value="48">48級</option>
                            <option value="49">49級</option>
                        </select>
                    </div>
                    <div class="flex-grow">
                        <label for="current-xp" class="block text-sm font-medium text-gray-700 mb-1">目前等級已獲得的經驗值：</label>
                        <input type="number" id="current-xp" class="form-input" placeholder="升到本級後，已獲得的經驗值" min="0">
                    </div>
                </div>
            </div>

            <!-- 任務列表容器 -->
            <div id="tasks-container"></div>

            <!-- 計算按鈕 -->
            <div class="mt-6 flex justify-center items-center gap-4">
                <button id="calculate-btn" class="btn btn-primary w-full sm:w-auto px-12 py-3 text-lg">開始計算</button>
                <button id="refresh-btn" class="btn btn-secondary w-full sm:w-auto px-12 py-3 text-lg">刷新頁面</button>
            </div>

            <!-- 結果顯示容器 -->
            <div id="results-container" class="mt-8"></div>
        </main>

    </div>

    <!-- 版本資訊 -->
    <div class="fixed bottom-4 right-4 text-gray-400 text-xs z-50">
        <span id="today-date"></span> | V3.0
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM 元素
            const levelSelect = document.getElementById('level-select');
            const calculateBtn = document.getElementById('calculate-btn');
            const refreshBtn = document.getElementById('refresh-btn');
            const tasksContainer = document.getElementById('tasks-container');
            const resultsContainer = document.getElementById('results-container');
            const currentXpInput = document.getElementById('current-xp');
            const todayDateSpan = document.getElementById('today-date');

            // --- 設定今天日期 ---
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            todayDateSpan.textContent = `${year}/${month}/${day}`;

            // 任務及經驗值資料
            const tasksData = {
                baseXp: {
                    48: 156000000,
                    49: 181000000,
                    50: 211000000
                },
                level49: {
                    title: '49級升級條件',
                    xp_required: 25000000,
                    tasks: [
                        { id: 'trade_300km', label: '交換十隻距離超過300公里的寶可夢', target: 10 },
                        { id: 'lucky_trade', label: '交換50隻亮晶晶寶可夢', target: 50 },
                        { id: 'send_gifts', label: '贈送500個禮物給朋友', target: 500 },
                        { id: 'platinum_medals', label: '獲得35面白金獎牌', target: 35 }
                    ]
                },
                level50: {
                    title: '50級升級條件',
                    xp_required: 30000000,
                    tasks: [
                        { id: 'excellent_throws', label: '投出999次Excellent', target: 999 },
                        { id: 'legendary_catch', label: '連續捕捉五隻傳說的寶可夢', target: 5 },
                        { id: 'leader_battle', label: '使用CP2500以下寶可夢打贏三次幹部', target: 3 },
                        { id: 'gbl_rank', label: '對戰聯盟中到達R10', target: 10 }
                    ]
                }
            };

            // 攻略提示
            const tips = {
                trade_300km: '上網加些國外好友，每天開7公里蛋，夏威夷蛋跟北海道蛋換一下，300公里根本小菜一碟！',
                lucky_trade: '是時候找你的換換夥伴了！每天換好換滿100隻，亮晶晶的機率就掌握在你們手中！',
                send_gifts: '你的好友列表還有空間嗎？是時候清一波殭屍，然後上網大喊「缺禮物+++++」了！',
                platinum_medals: '打開你的獎牌列表，看看哪些白金獎牌在跟你招手！是時候專心攻略它們了，別再分心抓綠毛蟲啦！',
                excellent_throws: 'Excellent不是夢！鎖定那些圈圈像月亮一樣大的寶可夢（說的就是你，固拉多！），每次團體戰都是練習的好機會！',
                legendary_catch: '嘿，偷偷告訴你一個秘密捷徑... 打開「神秘盒子」抓美錄坦也算數喔！別說是我說的！',
                leader_battle: '拿出你壓箱底的超級聯盟強隊，讓GO火箭隊幹部們瞧瞧你的厲害！CP2500以下才是技術的展現！',
                gbl_rank: '通往傳奇的路是用淚水和星塵鋪成的。研究一下Meta，祝你武運昌隆！'
            };
            
            // 渲染任務卡片
            function renderTasks() {
                const selectedLevel = levelSelect.value;
                tasksContainer.innerHTML = '';
                resultsContainer.innerHTML = ''; // 清空結果

                if (selectedLevel === '48') {
                    createTaskCards(tasksData.level49);
                    createTaskCards(tasksData.level50);
                } else if (selectedLevel === '49') {
                    createTaskCards(tasksData.level50);
                }
            }

            function createTaskCards(levelData) {
                const levelWrapper = document.createElement('div');
                levelWrapper.className = 'mt-6 level-wrapper';
                const headerDiv = document.createElement('div');
                headerDiv.className = 'flex justify-between items-center mb-4';
                const title = document.createElement('h2');
                title.className = 'text-2xl font-bold text-indigo-700';
                title.textContent = levelData.title;
                headerDiv.appendChild(title);
                levelWrapper.appendChild(headerDiv);
                levelData.tasks.forEach(task => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div class="flex flex-col md:flex-row md:items-center gap-4">
                            <div class="flex-grow">
                                <p class="font-semibold">${task.label}</p>
                                <p class="text-sm text-gray-500">目標: ${task.target.toLocaleString()}</p>
                            </div>
                            <div class="flex items-center gap-2 w-full md:w-auto">
                                <input type="number" id="${task.id}" class="form-input flex-grow" placeholder="目前進度" min="0" max="${task.target}">
                                <button class="btn btn-secondary whitespace-nowrap" data-target="${task.target}" data-input-id="${task.id}">已完成</button>
                            </div>
                        </div>
                    `;
                    levelWrapper.appendChild(card);
                });
                tasksContainer.appendChild(levelWrapper);
            }
            
            tasksContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON' && e.target.dataset.inputId) {
                    const inputId = e.target.dataset.inputId;
                    const targetValue = e.target.dataset.target;
                    const inputElement = document.getElementById(inputId);
                    if (inputElement) {
                        inputElement.value = targetValue;
                    }
                }
            });

            // 計算邏輯
            function calculateProgress() {
                const selectedLevel = parseInt(levelSelect.value, 10);
                const currentXp = parseInt(currentXpInput.value, 10) || 0;
                
                const endDate = new Date('2025-10-14T23:59:59');
                const today = new Date();
                
                if (today > endDate) {
                    resultsContainer.innerHTML = `<div class="card bg-red-100 text-red-800"><p class="font-bold text-center">目標日期已過，無法計算。</p></div>`;
                    return;
                }

                const diffTime = Math.abs(endDate - today);
                const totalDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                let resultsHTML = '';

                // --- 統一計算總經驗值 ---
                let totalRequiredXpFromStartLevel = 0;
                if (selectedLevel === 48) {
                    totalRequiredXpFromStartLevel = tasksData.level49.xp_required + tasksData.level50.xp_required;
                } else if (selectedLevel === 49) {
                    totalRequiredXpFromStartLevel = tasksData.level50.xp_required;
                }

                const remainingXp = Math.max(0, totalRequiredXpFromStartLevel - currentXp);
                const baseXp = tasksData.baseXp[selectedLevel] || 0;
                const actualCurrentTotalXp = baseXp + currentXp;
                const finalTargetXp = tasksData.baseXp[50];
                
                if (remainingXp > 0) {
                    const dailyXp = Math.ceil(remainingXp / totalDays);
                    let xpCardHTML = `
                        <div class="card bg-yellow-50 border-yellow-200">
                            <h3 class="text-xl font-bold mb-2 text-yellow-800">總經驗值目標 (剩餘 ${totalDays} 天)</h3>
                            <p><strong>每日需獲得 <span class="text-yellow-900 font-bold">${dailyXp.toLocaleString()}</span> XP</strong></p>`;
                    
                    let forecastHTML = `<div class="mt-3 pt-2 border-t border-yellow-100"><h4 class="text-sm font-semibold text-gray-700 mb-1">未來五日目標參考 (總經驗值)：</h4><ul class="list-disc list-inside text-sm text-gray-600 space-y-1">`;
                    for (let i = 1; i <= 5; i++) {
                        const targetDate = new Date();
                        targetDate.setDate(today.getDate() + i);
                        const monthStr = String(targetDate.getMonth() + 1).padStart(2, '0');
                        const dayStr = String(targetDate.getDate()).padStart(2, '0');
                        const cumulativeTargetXp = actualCurrentTotalXp + (dailyXp * i);

                        if (cumulativeTargetXp >= finalTargetXp) {
                            forecastHTML += `<li>${monthStr}/${dayStr}: <span class="font-bold text-green-600">達成50級目標 (${finalTargetXp.toLocaleString()} XP)</span></li>`;
                            break;
                        } else {
                            forecastHTML += `<li>${monthStr}/${dayStr}: 累計需達 <span class="font-bold">${Math.ceil(cumulativeTargetXp).toLocaleString()}</span> XP</li>`;
                        }
                    }
                    forecastHTML += '</ul></div>';
                    xpCardHTML += forecastHTML;
                    xpCardHTML += `</div>`;
                    resultsHTML += xpCardHTML;

                } else {
                     resultsHTML += `
                        <div class="card bg-green-50 border-green-200">
                             <h3 class="text-xl font-bold mb-2 text-green-800">總經驗值目標</h3>
                            <p class="text-green-700 font-bold">恭喜！經驗值已達標！</p>
                        </div>
                    `;
                }
                
                // --- 任務計算 ---
                const processLevelTasks = (levelTasks, daysForTask, theme, showForecast) => {
                    let levelResultsHTML = `<div class="card bg-${theme}-50 mt-4"><h3 class="text-xl font-bold mb-4 text-${theme}-800">${levelTasks.title}每日進度 (剩餘 ${daysForTask} 天)</h3><div class="space-y-4">`;
                    levelTasks.tasks.forEach(task => {
                        const input = document.getElementById(task.id);
                        const currentValue = parseInt(input.value, 10) || 0;
                        const remaining = Math.max(0, task.target - currentValue);
                        let taskHTML = `<div><p><strong>${task.label}:</strong> `;

                        if (remaining > 0 && daysForTask > 0) {
                            const dailyAverage = remaining / daysForTask;
                            taskHTML += `每日需完成 <span class="text-${theme}-600 font-bold">${dailyAverage.toFixed(2)}</span> 次/個</p>
                                       <p class="mt-1 pl-4 border-l-2 border-${theme}-200 text-sm text-gray-600 italic">攻略: ${tips[task.id]}</p>`;
                            
                            if (showForecast) {
                                let forecastHTML = `<div class="mt-3 pt-2 border-t border-${theme}-100"><h4 class="text-sm font-semibold text-gray-700 mb-1">未來五日目標參考：</h4><ul class="list-disc list-inside text-sm text-gray-600 space-y-1">`;
                                for (let i = 1; i <= 5; i++) {
                                    const targetDate = new Date();
                                    targetDate.setDate(today.getDate() + i);
                                    const monthStr = String(targetDate.getMonth() + 1).padStart(2, '0');
                                    const dayStr = String(targetDate.getDate()).padStart(2, '0');
                                    const cumulativeTarget = Math.ceil(currentValue + (dailyAverage * i));

                                    if (cumulativeTarget >= task.target) {
                                         forecastHTML += `<li>${monthStr}/${dayStr}: <span class="font-bold text-green-600">達成目標 (${task.target.toLocaleString()})</span></li>`;
                                         break; 
                                    } else {
                                         forecastHTML += `<li>${monthStr}/${dayStr}: 累計需達 <span class="font-bold">${cumulativeTarget.toLocaleString()}</span></li>`;
                                    }
                                }
                                forecastHTML += '</ul></div>';
                                taskHTML += forecastHTML;
                            }
                        } else {
                            taskHTML += `<span class="text-green-600 font-bold">已完成</span></p>`;
                        }
                        taskHTML += `</div>`;
                        levelResultsHTML += taskHTML;
                    });
                    levelResultsHTML += `</div></div>`;
                    return levelResultsHTML;
                }
                
                let showLevel50Forecast = true;
                if (selectedLevel === 48) {
                    let allLevel49TasksDone = true;
                    tasksData.level49.tasks.forEach(task => {
                        const input = document.getElementById(task.id);
                        const currentValue = parseInt(input.value, 10) || 0;
                        if (currentValue < task.target) {
                            allLevel49TasksDone = false;
                        }
                    });
                    if (!allLevel49TasksDone) {
                        showLevel50Forecast = false;
                    }
                }

                if (selectedLevel <= 48) {
                    const daysFor49 = Math.floor(totalDays / 2);
                    resultsHTML += processLevelTasks(tasksData.level49, daysFor49, 'indigo', true);
                }
                if (selectedLevel <= 49) {
                    const daysFor50 = (selectedLevel === 48) ? Math.ceil(totalDays / 2) : totalDays;
                    resultsHTML += processLevelTasks(tasksData.level50, daysFor50, 'purple', showLevel50Forecast);
                }

                resultsContainer.innerHTML = resultsHTML;
            }

            levelSelect.addEventListener('change', renderTasks);
            calculateBtn.addEventListener('click', calculateProgress);
            refreshBtn.addEventListener('click', () => location.reload());
            renderTasks();
        });
    </script>
</body>
</html>

